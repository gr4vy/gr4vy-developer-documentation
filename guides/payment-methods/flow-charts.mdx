---
title: Flow charts
---

import Mermaid from "@theme/Mermaid";

## Example without Gr4vy Embed

<Mermaid
  chart={`
    sequenceDiagram
      participant m as Merchant Site
      participant g as Gr4vy API
      participant p as PayPal Site
      note over m: Buyer clicks to use PayPal
      note over m: API call: Start PayPal tokenization
      m-->>g: POST /payment-methods { return_url: "example.com/return" }
      note over g: Create payment-method record
      g-->>m: { authorization_url: "redirect.*.gr4vy.com/payment-methods/123" }
      note over m: Redirect buyer to authorization URL
      m-->>g: GET redirect.*.gr4vy.com/payment-methods/123
      note over g: Get payment-method record
      note over g: API call: Create PayPal order
      g-->>p: POST /v2/checkout/orders
      p-->>g: { authorization_url: "paypal.com/..." }
      note over g: Redirect buyer to PayPal auth url
      g->p: GET paypal.com/...
      note over p: Buyer logs in
      note over p: Buyer confirms authorization
      note over p: Redirect buyer back to Gr4vy
      p->>g: GET api.*.gr4vy.com/payment-methods/123/callback?token=617312682
      note over g: Update payment method record
      note over g: Redirect buyer back to merchant site
      g->>m: GET example.com/return?payment_method_id=...&payment_method_status=...
      note over m: Fetch payment method status
      m-->>g: GET /payment-methods/123
      g-->>m: { status: 'stored' }
`}
/>

## Example with Gr4vy Embed

<Mermaid
  chart={`
    sequenceDiagram
      participant e as Embed
      participant m as Embedded SPA
      participant g as Gr4vy API
      participant p as PayPal
      note over e: Embed loads frame
      e-->>m: GET cdn.*.gr4vy.com/embed
      note over m: Buyer selects PayPal option
      note over m: Buyer clicks PayPal button
      note over m: API call: Start PayPal tokenization
      m-->>g: POST /payment-methods { return_url: "cdn.*.gr4vy.com/embed" }
      note over g: Create payment-method record
      g-->>m: { authorization_url: "redirect.*.gr4vy.com/payment-methods/123", ... }
      note over m: Frame notifies parent page to open popup
      m-->>e: framebus.emit('openPopup', { authorization_url })
      note over e: Embed opens popup with authorization URL
      e->>g: GET redirect.*.gr4vy.com/payment-methods/123
      note over g: Fetch payment-method record
      note over g: API call: Create PayPal order
      g-->>p: POST /v2/checkout/orders
      p-->>g: { authorization_url: "paypal.com/..." }
      note over g: Redirect buyer to PayPal auth url
      g->p: GET paypal.com/...
      note over p: Buyer logs in
      note over p: Buyer confirms authorization
      note over p: Redirect buyer back to Gr4vy
      p->>g: GET api.*.gr4vy.com/payment-methods/123/callback?token=617312682
      note over g: Update payment method record
      note over g: Redirect buyer back to Gr4vy Embed SPA
      g->>m: GET cdn.***.gr4vy.com/embed?payment_method_id=...&payment_method_status=...
      note over m: SPA in popup notifies of new payment method
      m-->>e: framebus.emit('paymentMethod', { id, status })
      note over e: Embed closes popup
      m-->>m: framebus.emit('paymentMethod', { id, status })
      note over m: Frame confirms payment method status
      m-->>g: GET /payment-methods/123
      g-->>m: { status: 'stored', .... }
`}
/>
