---
title: Register a payment method
---

## Option 1

Option 1 uses different endpoints for different payment methods that support
tokenization/registration.

### Register a card

To register a card, we call `POST /cards`.

```bash
curl -i -X POST "https://***.api.gr4vy.com/cards" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json" \
    -d '{
      "number": "4111111111111111",
      "expiration_date": "11/25",
      "security_code": "123",
      "external_identifier": "card-1234"
    }'
```

The response object is a card resource.

```json
{
  "type": "card",
  "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
  "status": "created",
  "created_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": "card-1234"
}
```

### Register a PayPal account

To register a PayPal account, we call `POST /paypal-accounts`.

```bash
curl -i -X POST "https://***.api.gr4vy.com/paypal-accounts" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json" \
    -d '{
      "external_identifier": "account-1234"
    }'
```

The response object is a PayPal account resource.

```json
{
  "type": "paypal-account",
  "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
  "status": "created",
  "created_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": "account-1234",
  "authorization_url": "https://paypal.com/...."
}
```

## Option 2

In option 2, we don't have separate APIs for different payment methods, instead
we have payment method definitions and use these to register distinct payment
methods.

### Get a definition

Though technically not necessary, we could fetch a list of payment method
definitions to know what fields are required for a payment method to be
registered.

```bash
curl -i -X GET "https://***.api.gr4vy.com/payment-method-definitions/card" \
    -H "Authorization: Bearer [JWT_TOKEN]"
```

```json
{
  "id": "card",
  "type": "payment-method-definition",
  "display_name": "Card",
  "fields": [
    {
      "key": "number",
      "display_name": "Number",
      "required": true
    },
    {
      "key": "expiration_date",
      "display_name": "Expiration date",
      "required": false
    },
    {
      "key": "security_code",
      "display_name": "Security code",
      "required": false
    }
  ]
}
```

### Register a card

We can then register a card by referencing the payment method definition.

```bash
curl -i -X POST "https://***.api.gr4vy.com/payment-methods" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json" \
    -d '{
      "payment_method_definition_id": "card",
      "buyer_id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
      "external_identifier": "card-1234",
      "fields": {
        "number": "4111111111111111",
        "expiration_date": "11/25",
        "security_code": "123",
      }
    }'
```

The response is a payment method resource, referencing the payment method
definition `card`.

```json
{
  "type": "payment-method",
  "payment_method_definition_id": "card",
  "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
  "status": "created",
  "created_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": "card-1234",
  "buyer": {
    "type": "buyer",
    "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
    "external_identifier": "user-2345",
    "display_name": "John L.",
    "created_at": "2013-07-16T19:23:00.000Z",
    "updated_at": "2013-07-16T19:23:00.000Z"
  },
  "details": {
    "number": "XXXX XXXX XXXX 1111",
    "expiration_date": "11 / 21"
  }
}
```

### Register a PayPal account

To register a PayPal account we use the same API, but now we reference the
`paypal` payment definition ID.

```bash
curl -i -X POST "https://***.api.gr4vy.com/payment-methods" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json" \
    -d '{
      "payment_method_definition_id": "paypal",
      "buyer_id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
      "external_identifier": "paypal-1234",
    }'
```

The response is again a payment method object, but now referencing the `paypal`
payment method definition.

```json
{
  "type": "payment-method",
  "payment_method_definition_id": "paypal",
  "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
  "status": "created",
  "created_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": "paypal-1234",
  "buyer": {
    "type": "buyer",
    "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
    "external_identifier": "user-2345",
    "display_name": "John L.",
    "created_at": "2013-07-16T19:23:00.000Z",
    "updated_at": "2013-07-16T19:23:00.000Z"
  },
  "details": {
    "authorization_url": "https://paypal.com/...."
  }
}
```

### Fetch payment methods for a buyer

To fetch the registered payment methods for a buyer, call the
`GET /payment-methods?buyer_id={buyer_id}` API.

```bash
curl -i -X GET "https://***.api.gr4vy.com/payment-methods?buyer_id=fe26475d-ec3e-4884-9553-f7356683f7f9" \
    -H "Authorization: Bearer [JWT_TOKEN]"
```

```json
{
  "items": [
    {
      "type": "payment-method",
      "payment_method_definition_id": "card",
      "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
      "status": "created",
      "created_at": "2013-07-16T19:23:00.000Z",
      "external_identifier": "card-1234",
      "buyer": {
        "type": "buyer",
        "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
        "external_identifier": "user-2345",
        "display_name": "John L.",
        "created_at": "2013-07-16T19:23:00.000Z",
        "updated_at": "2013-07-16T19:23:00.000Z"
      },
      "details": {
        "number": "XXXX XXXX XXXX 1111",
        "expiration_date": "11 / 21"
      }
    },
    {
      "type": "payment-method",
      "payment_method_definition_id": "paypal",
      "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
      "status": "created",
      "created_at": "2013-07-16T19:23:00.000Z",
      "external_identifier": "paypal-1234",
      "buyer": {
        "type": "buyer",
        "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
        "external_identifier": "user-2345",
        "display_name": "John L.",
        "created_at": "2013-07-16T19:23:00.000Z",
        "updated_at": "2013-07-16T19:23:00.000Z"
      },
      "details": {
        "authorization_url": "https://paypal.com/...."
      }
    }
  ],
  "limit": 100,
  "next_page": null,
  "previous_page": null
}
```

### Register as part of transaction

Finally, a small update to the transaction API to allow for a payment method to
be stored on creating a transaction.

#### Card

```bash
curl -i -X POST "https://***.api.gr4vy.com/transactions" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json" \
    -d '{
      "amount": 1299,
      "currency": "USD",
      "external_identifier": "card-1234",
      "payment_method": {
        "buyer_id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
        "payment_method_definition_id": "card",
        "fields": {
          "number": "4111111111111111",
          "expiration_date": "11/25",
          "security_code": "123",
          "register": true
        }
      }
    }'
```

```json
{
  "type": "transaction",
  "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
  "status": "created",
  "transaction_status": "created",
  "amount": 1299,
  "currency": "USD",
  "payment_method": {
    "type": "payment-method",
    "payment_method_definition_id": "card",
    "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
    "status": "created",
    "created_at": "2013-07-16T19:23:00.000Z",
    "external_identifier": "card-1234",
    "buyer": {
      "type": "buyer",
      "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
      "external_identifier": "user-2345",
      "display_name": "John L.",
      "created_at": "2013-07-16T19:23:00.000Z",
      "updated_at": "2013-07-16T19:23:00.000Z"
    },
    "details": {
      "number": "XXXX XXXX XXXX 1111",
      "expiration_date": "11 / 21"
    }
  },
  "created_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": "user-789123",
  "updated_at": "2019-08-24T14:15:22Z",
  "payment_service_id": "stripe-card-169f5226-4644-4d1e-ac36-14999e73601f"
}
```

#### PayPal

```bash
curl -i -X POST "https://***.api.gr4vy.com/transactions" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json" \
    -d '{
      "amount": 1299,
      "currency": "USD",
      "external_identifier": "card-1234",
      "payment_method": {
        "buyer_id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
        "payment_method_definition_id": "paypal"
      }
    }'
```

```json
{
  "type": "transaction",
  "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
  "status": "created",
  "transaction_status": "created",
  "amount": 1299,
  "currency": "USD",
  "payment_method": {
    "type": "payment-method",
    "payment_method_definition_id": "paypal",
    "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
    "status": "created",
    "created_at": "2013-07-16T19:23:00.000Z",
    "buyer": {
      "type": "buyer",
      "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
      "external_identifier": "user-2345",
      "display_name": "John L.",
      "created_at": "2013-07-16T19:23:00.000Z",
      "updated_at": "2013-07-16T19:23:00.000Z"
    },
    "details": {
      "authorization_url": "https://paypal.com/...."
    }
  },
  "created_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": "user-789123",
  "updated_at": "2019-08-24T14:15:22Z",
  "payment_service_id": "stripe-card-169f5226-4644-4d1e-ac36-14999e73601f"
}
```
