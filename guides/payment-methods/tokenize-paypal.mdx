---
title: Tokenize a PayPal account
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

A PayPal account can be tokenized by calling the [`POST /payment-methods`][api]
API. The call requires a `method` and a `redirect_url`. Additionally, the API
call accepts a `buyer_id` or `buyer_external_identifier` which can be used to
associate a card to a previously registered [buyer].

:::caution 2-step process

Registering a PayPal account is a 2-step process that requires a user-redirect
to get explicit authorization.

:::

[api]: /reference#operation/register-payment-method
[buyer]: /guides/buyers/add

## Step 1. Initialize a new PayPal payment method

The first step is to initialize a new PayPal payment method using the
`redirect_url` that you'd like to redirect the user to. This `redirect_url`
needs to match the `redirect_url` you specified in your PayPal application.

<Tabs
  groupId="language"
  defaultValue="curl"
  values={[
    { label: 'cURL', value: 'curl', },
    { label: 'Node', value: 'node', },
  ]}
>
  <TabItem value="curl">

```bash {5-9}
curl -i -X POST "https://***.api.gr4vy.com/payment-methods" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json" \
    -d '{
        "method": "paypal",
        "return_url": "http://localhost:3000/callback",
        "buyer_external_identifier": "user-789123"
      }'
```

  </TabItem>
  <TabItem value="node">

```js {10-14}
const fetch = require("node-fetch");

fetch("https://***.api.gr4vy.com/payment-methods", {
  method: "POST",
  headers: {
    Authorization: "Bearer [JWT_TOKEN]",
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    method: "paypal",
    return_url: "http://localhost:3000/callback",
    buyer_external_identifier: "user-789123",
  }),
});
```

  </TabItem>
</Tabs>

The API returns a new `payment-method` resource for which the
`payment_method_status` is set to `buyer_authorization_required`.

```json
{
  "type": "payment-method",
  "id": "77a76f7e-d2de-4bbc-ada9-d6a0015e6bd5",
  "method": "paypal",
  "status": "created",
  "payment_method_status": "buyer_authorization_required",
  "details": {
    "authorization_url": "https://paypal.com....."
  },
  "created_at": "2013-07-16T19:23:00.000Z",
  "updated_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": null,
  "buyer": {
    "type": "buyer",
    "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
    "external_identifier": "user-789123",
    "display_name": "John L.",
    "created_at": "2013-07-16T19:23:00.000Z",
    "updated_at": "2013-07-16T19:23:00.000Z"
  }
}
```

## Step 2. Redirect the user

Next, redirect the user to the URL detailed in the `details.authorization_url`
field.

The user then logs in to their PayPal account and authorizes the PayPal account
to be tokenized by Gr4vy. After this, the user is redirected back to the
`redirect_url` you specified earlier. For example:

```
http://localhost:3000?callback?token=.....&payment_method_id=77a76f7e-d2de-4bbc-ada9-d6a0015e6bd5
```

The `payment_method_id` query parameter represents the ID of the payment method
that this PayPal account has been registered as. The `token` represents a
confirmation code generated by PayPal and it can be ignored.

## Step 3. Confirm the authorization

Finally, make an API call to confirm the authorization for the tokenized PayPal
payment method using the `payment_method_id` from the query parameter.

<Tabs
  groupId="language"
  defaultValue="curl"
  values={[
    { label: 'cURL', value: 'curl', },
    { label: 'Node', value: 'node', },
  ]}
>
  <TabItem value="curl">

```bash {5-9}
curl -i -X POST "https://***.api.gr4vy.com/payment-methods/77a76f7e-d2de-4bbc-ada9-d6a0015e6bd5/authorize" \
    -H "Authorization: Bearer [JWT_TOKEN]" \
    -H "Content-Type: application/json"
```

  </TabItem>
  <TabItem value="node">

```js {10-14}
const fetch = require("node-fetch");

fetch(
  "https://***.api.gr4vy.com/payment-methods/77a76f7e-d2de-4bbc-ada9-d6a0015e6bd5",
  {
    method: "POST",
    headers: {
      Authorization: "Bearer [JWT_TOKEN]",
      "Content-Type": "application/json",
    },
  }
);
```

  </TabItem>
</Tabs>

The API will return the same `payment-method` resource with an updated
`payment_method_status` is set to `registered`.

```json
{
  "type": "payment-method",
  "id": "77a76f7e-d2de-4bbc-ada9-d6a0015e6bd5",
  "method": "paypal",
  "status": "created",
  "payment_method_status": "registered",
  "details": {
    "authorization_url": null
  },
  "created_at": "2013-07-16T19:23:00.000Z",
  "updated_at": "2013-07-16T19:23:00.000Z",
  "external_identifier": null,
  "buyer": {
    "type": "buyer",
    "id": "fe26475d-ec3e-4884-9553-f7356683f7f9",
    "external_identifier": "user-789123",
    "display_name": "John L.",
    "created_at": "2013-07-16T19:23:00.000Z",
    "updated_at": "2013-07-16T19:23:00.000Z"
  }
}
```
